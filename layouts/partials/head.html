<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} · {{ .Site.Title }}{{ end }}</title>
<meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Summary | truncate 160 }}{{ end }}">

{{/* Open Graph */}}
<meta property="og:title" content="{{ .Title }}">
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:site_name" content="{{ .Site.Title }}">
{{ with .Description }}<meta property="og:description" content="{{ . }}">{{ end }}

{{/* RSS autodiscovery */}}
{{ range .AlternativeOutputFormats -}}
  {{ printf `<link rel="%s" type="%s" href="%s" title="%s">` .Rel .MediaType.Type .Permalink (printf "%s - %s" $.Site.Title .Name) | safeHTML }}
{{ end -}}

{{/* Dark mode: runs before render to prevent FOUC */}}
<script>
(function() {
  var validPrefs = ['light', 'dark', 'system'];
  var pref = 'system';
  try { pref = localStorage.getItem('theme') || 'system'; } catch (e) {}
  if (validPrefs.indexOf(pref) === -1) pref = 'system';
  var theme = pref === 'system'
    ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
    : pref;
  document.documentElement.setAttribute('data-theme', theme);
  document.documentElement.setAttribute('data-theme-pref', pref);
})();
</script>

{{/* Font preload */}}
<link rel="preload" href="/fonts/SourceSerif4Variable-Roman.ttf.woff2" as="font" type="font/woff2" crossorigin>

{{/* CSS via Hugo Pipes — concat all partials since @import doesn't resolve */}}
{{ $base := resources.Get "css/_base.css" }}
{{ $layout := resources.Get "css/_layout.css" }}
{{ $components := resources.Get "css/_components.css" }}
{{ $content := resources.Get "css/_content.css" }}
{{ $sidenotes := resources.Get "css/_sidenotes.css" }}
{{ $toc := resources.Get "css/_toc.css" }}
{{ $chromaLight := resources.Get "css/_chroma-light.css" }}
{{ $chromaDark := resources.Get "css/_chroma-dark.css" }}
{{ $dark := resources.Get "css/_dark.css" }}
{{ $search := resources.Get "css/_search.css" }}
{{ $preview := resources.Get "css/_preview.css" }}
{{ $css := slice $base $layout $components $content $sidenotes $toc $chromaLight $chromaDark $dark $search $preview | resources.Concat "css/bundle.css" | minify | fingerprint }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}" integrity="{{ $css.Data.Integrity }}">

{{/* Conditional KaTeX loading */}}
{{ if findRE `\$\$|\\\(|\\\[` .Content }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5RLHO8BIp/8hmBQ30JRIh4E0P5X/8sNlPIax6KF+dVVqzCzt8e9" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRjXlZBYSaKDPlSP" crossorigin="anonymous"
  onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true},{left: '\\\\(', right: '\\\\)', display: false},{left: '\\\\[', right: '\\\\]', display: true}]});"></script>
{{ end }}

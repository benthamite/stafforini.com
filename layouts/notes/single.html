{{ define "main" }}
<article>
  <h1>{{ .Title | safeHTML }}</h1>

  {{ partial "note-meta.html" . }}

  <div class="note-body">
    {{ .Content }}
  </div>

  {{/* References â€” works cited in this note (extracted from rendered cite shortcode links) */}}
  {{ if not .Params.hide_references }}
  {{ $citedWorks := slice }}
  {{ range where .Site.RegularPages "Section" "works" }}
    {{ $workPath := printf "/works/%s/" .File.ContentBaseName }}
    {{ if in $.Content $workPath }}
      {{ $citedWorks = $citedWorks | append . }}
    {{ end }}
  {{ end }}
  {{ with $citedWorks }}
  <section class="references" aria-label="References">
    <h2>References</h2>
    <ul>
      {{ range (sort . "Title") }}
        {{ $type := .Params.entry_type | default "book" }}
      <li>{{ partial "citation-format.html" (dict "work" . "type" $type "link" true) }}</li>
      {{ end }}
    </ul>
  </section>
  {{ end }}
  {{ end }}

  {{ partial "backlinks.html" . }}
</article>

{{/* Link preview only needed on note pages (other sections don't have internal prose links to preview) */}}
{{ $linkPreview := resources.Get "js/link-preview.js" | minify | fingerprint }}
<script src="{{ $linkPreview.RelPermalink }}" integrity="{{ $linkPreview.Data.Integrity }}"></script>
{{ end }}

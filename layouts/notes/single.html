{{ define "main" }}
<article>
  {{/* is_topic_stub: auto-generated topic pages (from generate-topic-pages.py)
       that only have a title and backlinks â€” skip TOC, metadata, body, and sidenotes */}}
  {{ if not .Params.is_topic_stub }}
  {{ partial "toc-floating.html" . }}
  {{ end }}

  <h1>{{ .Title | safeHTML }}</h1>

  {{ if not .Params.is_topic_stub }}
  {{ partial "note-meta.html" . }}

  {{ partial "toc-inline.html" . }}

  <div class="content-with-sidenotes">
    <div class="note-body">
      {{ .Content }}
    </div>
    <aside class="sidenote-column" aria-label="Sidenotes"></aside>
  </div>
  {{ end }}

  {{ partial "backlinks.html" . }}
</article>

{{ if not .Params.is_topic_stub }}
{{ $sidenotes := resources.Get "js/sidenotes.js" | minify | fingerprint }}
<script src="{{ $sidenotes.RelPermalink }}" integrity="{{ $sidenotes.Data.Integrity }}"></script>
{{ $toc := resources.Get "js/toc.js" | minify | fingerprint }}
<script src="{{ $toc.RelPermalink }}" integrity="{{ $toc.Data.Integrity }}"></script>
{{ end }}
{{/* Link preview only needed on note pages (other sections don't have internal prose links to preview) */}}
{{ $linkPreview := resources.Get "js/link-preview.js" | minify | fingerprint }}
<script src="{{ $linkPreview.RelPermalink }}" integrity="{{ $linkPreview.Data.Integrity }}"></script>
{{ end }}

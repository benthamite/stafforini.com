{{ define "main" }}
{{/* Extract work metadata for Pagefind: quote pages lack author/title in their own front matter,
     so we resolve the linked work and inject its metadata as hidden spans for search indexing.
     data-pagefind-meta="title" overrides Pagefind's default title extraction. */}}
{{ $workAuthor := "" }}{{ $workTitle := "" }}{{ $workType := "book" }}
{{ with .Params.work }}
  {{ $work := $.Site.GetPage (printf "/works/%s" .) }}
  {{ with $work }}
    {{ $workAuthor = .Params.author }}
    {{ $workTitle = .Title }}
    {{ $workType = .Params.entry_type | default "book" }}
  {{ end }}
{{ end }}
<div>
  {{ with $workAuthor }}
  <span data-pagefind-meta="title" data-pagefind-ignore class="visually-hidden">{{ $workAuthor }} â€“ {{ $workTitle }}</span>
  <span data-pagefind-meta="work_author" data-pagefind-ignore class="visually-hidden">{{ $workAuthor }}</span>
  <span data-pagefind-meta="work_title" data-pagefind-ignore class="visually-hidden">{{ $workTitle }}</span>
  <span data-pagefind-meta="work_type" data-pagefind-ignore class="visually-hidden">{{ $workType }}</span>
  {{ end }}
  <div class="content-with-sidenotes">
    <div class="quote-body">
      {{ partial "quote-entry.html" . }}
    </div>
    <aside class="sidenote-column" aria-label="Sidenotes"></aside>
  </div>
</div>

{{ $sidenotesJS := resources.Get "js/sidenotes.js" | minify | fingerprint }}
<script src="{{ $sidenotesJS.RelPermalink }}" integrity="{{ $sidenotesJS.Data.Integrity }}"></script>
{{ end }}

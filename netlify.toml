[build]
command = "hugo --minify && npx pagefind --site public"
publish = "public"

[build.environment]
HUGO_VERSION = "0.151.2"
NODE_VERSION = "20"

[[headers]]
for = "/*"
  [headers.values]
  X-Frame-Options = "DENY"
  X-Content-Type-Options = "nosniff"
  Referrer-Policy = "strict-origin-when-cross-origin"

[[headers]]
for = "/fonts/*"
  [headers.values]
  Cache-Control = "public, max-age=31536000, immutable"

# RSS feed redirects (preserve subscribers from WordPress)
[[redirects]]
from = "/blog/feed/"
to = "/notes/index.xml"
status = 301

[[redirects]]
from = "/blog/feed"
to = "/notes/index.xml"
status = 301

[[redirects]]
from = "/tango/feed/"
to = "/notes/index.xml"
status = 301

[[redirects]]
from = "/tango/feed"
to = "/notes/index.xml"
status = 301

[[redirects]]
from = "/quotes/"
query = { feed = "rss2" }
to = "/quotes/index.xml"
status = 301

# General blog â†’ notes redirect
[[redirects]]
from = "/blog/*"
to = "/notes/:splat"
status = 301

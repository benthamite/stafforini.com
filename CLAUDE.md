# stafforini.com conventions

## SPEC

@SPEC.md

## Important: `content/` is generated — never edit it directly

The `content/` directory contains markdown files generated by ox-hugo export from org source files. These files are gitignored and exist only on disk — they are **not tracked on `main`**. To deploy them to Netlify, run `scripts/deploy.sh`, which builds a `deploy` branch combining the tracked code with the generated content.

- **Notes** are exported from org files in `~/My Drive/notes/`
- **Quotes** are exported from org files in `~/My Drive/bibliographic-notes/`
- **Works** are generated by `scripts/generate-work-pages.py` from BibTeX data

To fix content issues, always edit the upstream source (org files or bib files), then re-export. Any direct edits to `content/` will be silently overwritten on the next export.

## Deployment

`scripts/deploy.sh` builds the Hugo site locally and pushes it directly to Netlify via CLI. There is no CI/CD from git pushes — all deploys are triggered by running the script.

Workflow: export from org-mode, then run `scripts/deploy.sh`.

## Companion Emacs package

The [`stafforini.el`](https://github.com/benthamite/stafforini.el) package provides Emacs commands for driving the build pipeline (exporting notes/quotes, regenerating work pages and backlinks, starting the dev server, etc.). See PUBLISHING.md for the full command reference. The package lives in a separate repo but wraps the scripts in this one.

**Local path**: `~/.config/emacs-profiles/7.1.30-target/elpaca/repos/stafforini/stafforini.el`

When telling the user to run a script, always mention the corresponding `stafforini.el` command (accessible via `stafforini-menu`):

| Script | Emacs command | Menu key |
|--------|--------------|----------|
| `scripts/export-notes.sh` | `stafforini-export-all-notes` | `n` |
| `scripts/export-quotes.sh` | `stafforini-export-all-quotes` | `q` |
| *(per-file)* | `stafforini-publish-note` | `p` |
| `scripts/generate-work-pages.py` | `stafforini-update-works` | `w` |
| `scripts/generate-backlinks.py` | `stafforini-update-backlinks` | `b` |
| `scripts/process-pdfs.py` | `stafforini-process-pdfs` | `d` |
| Full pipeline | `stafforini-full-rebuild` | `R` |
| Search index | `stafforini-rebuild-search-index` | `i` |
| `scripts/deploy.sh` | `stafforini-deploy` | `D` |
| Hugo dev server | `stafforini-start-server` / `stafforini-stop-server` | `s` / `k` |

**Note:** Several scripts are now run automatically as part of the export workflows and no longer have dedicated menu entries: `inject-lastmod.py`, `generate-citing-notes.py` (run by `export-notes.sh`), and `generate-id-slug-map.py`, `generate-topic-pages.py` (run by `export-quotes.sh`). They remain independently runnable via `M-x` for debugging.
